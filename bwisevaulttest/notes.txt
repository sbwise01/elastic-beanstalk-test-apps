export VAULT_ADDR='https://server.dc1.vault:8200'
export VAULT_CAPATH=/etc/vault.d/ssl/ca.cert
export CONSUL_HTTP_ADDR=server.dc1.consul:443
export CONSUL_HTTP_SSL=true
export CONSUL_HTTP_SSL_VERIFY=false
export CONSUL_CACERT=/etc/consul/ssl/ca.cert
export CONSUL_TLS_SERVER_NAME=server.dc1.consul


RDS_DB_NAME=bwtestdb
RDS_USERNAME=bwtestdb
RDS_PASSWORD=bwtestdb
RDS_HOSTNAME=bwtestdb.ciudrwvthdkg.us-east-1.rds.amazonaws.com
RDS_PORT=3306


https://www.vaultproject.io/docs/secrets/databases/mysql-maria.html

vault secrets enable database

vault write database/config/my-mysql-database \
    plugin_name=mysql-database-plugin \
    connection_url="{{username}}:{{password}}@tcp(bwtestdb.ciudrwvthdkg.us-east-1.rds.amazonaws.com:3306)/" \
    allowed_roles="my-role" \
    username="bwtestdb" \
    password="bwtestdb"


vault write database/roles/my-role \
    db_name=my-mysql-database \
    creation_statements="CREATE USER '{{name}}'@'%' IDENTIFIED BY '{{password}}';GRANT SELECT ON *.* TO '{{name}}'@'%';" \
    default_ttl="5m" \
    max_ttl="1h"

